# 🛡️ バックアップ戦略 - 678 Studio

## 概要
678 StudioのWordPressサイトのための包括的なバックアップ戦略を説明します。

## バックアップの種類と使い分け

### 1. 完全バックアップ (Full Backup)
- **用途**: 最高レベルの安全性が必要な場合
- **サイズ**: 7.6GB
- **時間**: 5-10分
- **内容**: 全ファイル（node_modules、ログファイル含む）
- **推奨頻度**: 大きな変更前、本番デプロイ前

### 2. 最適化バックアップ (Optimized Backup)
- **用途**: 日常的なバックアップ
- **サイズ**: 3-4GB (約50%削減)
- **時間**: 3-5分
- **内容**: 必要ファイルのみ（除外設定適用）
- **推奨頻度**: 毎日または重要な変更後

### 3. 本番環境バックアップ (Production Backup)
- **用途**: 本番環境からのデータ取得
- **サイズ**: 変動
- **時間**: 10-20分（ネットワーク依存）
- **内容**: 本番環境の完全コピー
- **推奨頻度**: 週1回または本番変更後

## バックアップスケジュール

### 開発フェーズ別推奨スケジュール

#### 開発中
- **毎日**: 最適化バックアップ
- **重要機能完成時**: 完全バックアップ
- **週末**: 完全バックアップ + 古いバックアップ削除

#### テスト中
- **テスト開始前**: 完全バックアップ
- **バグ修正後**: 最適化バックアップ
- **リリース前**: 完全バックアップ

#### 本番運用中
- **毎日**: 本番環境バックアップ
- **メンテナンス前**: 完全バックアップ
- **月1回**: ローカル環境の完全整理

## 除外設定の詳細

### 最適化バックアップで除外される項目

#### 開発関連
- `node_modules/` - npm依存関係
- `.git/` - Git履歴
- `.vscode/`, `.idea/` - エディタ設定
- `*.log` - ログファイル

#### WordPress関連
- `wp-content/debug-logs/` - デバッグログ
- `wp-content/uploads/cache/` - キャッシュファイル
- `wp-content/backup*/` - 既存バックアップ

#### システム関連
- `.DS_Store`, `Thumbs.db` - OS生成ファイル
- `*.tmp`, `*.swp` - 一時ファイル
- `cache/`, `temp/` - キャッシュディレクトリ

## 復旧戦略

### 復旧の種類

#### 1. 完全復旧
- 全ファイルの置き換え
- Docker環境の再構築
- データベースの完全復元

#### 2. 部分復旧
- 特定ファイル・ディレクトリのみ復元
- 設定ファイルの復旧
- プラグイン・テーマの復旧

#### 3. データベースのみ復旧
- SQL dumpからの復元
- Docker volumeの復旧

### 復旧手順

1. **事前準備**
   - 現在の状態のバックアップ
   - Docker コンテナの停止

2. **復旧実行**
   - バックアップからのファイルコピー
   - 権限・所有者の設定

3. **事後確認**
   - Docker コンテナの再起動
   - サイト動作確認
   - ログの確認

## リスク管理

### バックアップの冗長化
- **ローカル**: 複数のバックアップを保持
- **外部**: 外部ストレージへのコピー
- **クラウド**: Google Drive、Dropboxなど

### 定期的な復旧テスト
- **月1回**: バックアップからの復旧テスト
- **四半期**: 完全な環境再構築テスト
- **年1回**: 災害復旧シナリオテスト

### バックアップの検証
- **整合性チェック**: ファイルサイズ、チェックサム
- **動作確認**: 復旧後のサイト動作テスト
- **データ検証**: データベース内容の確認

## 容量管理

### 保持期間の設定
- **日次バックアップ**: 14日間保持
- **週次バックアップ**: 8週間保持
- **月次バックアップ**: 12ヶ月保持

### 自動クリーンアップ
```bash
# 14日以上古いバックアップを削除
./backup-manager.sh cleanup --days 14

# カスタム期間での削除
./backup-manager.sh cleanup --days 30
```

## モニタリング

### バックアップ成功の確認
- ログファイルでの確認
- ファイルサイズの監視
- 自動通知設定（今後実装予定）

### アラート設定
- バックアップ失敗時の通知
- 容量不足の警告
- 古いバックアップの警告

## ベストプラクティス

### 実行前チェック
1. 十分な空き容量があるか確認
2. 重要な作業が進行中でないか確認
3. Docker の状態確認

### セキュリティ
- バックアップファイルの暗号化検討
- アクセス権限の適切な設定
- 機密情報の除外設定

### パフォーマンス
- ピーク時間を避けた実行
- 並列処理の活用
- SSDへのバックアップ推奨

この戦略に従って、安全で効率的なバックアップ運用を実現できます。