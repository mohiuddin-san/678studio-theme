@use 'sass:map';
@use 'sass:math';
@use 'sass:string';

@use 'variables' as v;

/*
 * Mixins
 * 再利用可能なスタイルパターンを定義
 */

// Breakpoints
$breakpoints: (
	'xsm': 320px,
	'sm': 480px,
	'md': 768px,
	'lg': 1024px,
	'xl': 1280px,
	'xxl': 1440px,
);

// メディアクエリ（デフォルトをmax-widthに変更）
@mixin mq($breakpoint, $type: max) {
	@if map.has-key($breakpoints, $breakpoint) {
		$value: map.get($breakpoints, $breakpoint);

		@if $type == max {
			// 指定値より小さい（未満）
			$value: $value - 1;
			@media (max-width: #{$value}) {
				@content;
			}
		} @else {
			// 指定値以上
			@media (min-width: #{$value}) {
				@content;
			}
		}
	} @else {
		@error 'Invalid breakpoint: #{$breakpoint}';
	}
}

/**
 * シンプル化したレスポンシブサイズ関数 - 縮小率を直接指定可能
 * 
 * @param {Number} $max-size - 最大サイズ（PC向け1440pxでの値）
 * @param {Number} $ratio - 縮小率（デフォルト0.74）
 * @return {String} - 計算されたcalc()式
 * 
 * 使用例:
 * font-size: fs(20);           // 基本使用法（デフォルト縮小率0.74）
 * font-size: fs(20, 0.5);      // 縮小率0.5で計算
 * font-size: fs(20, 1.2);      // 拡大率1.2で計算
 */
@function fs($max-size, $ratio: 0.74) {
	// 固定のビューポート範囲
	$min-vw: 768;
	$max-vw: 1440;

	// 最小サイズを計算
	$min-size: $max-size * $ratio;

	// calc式を返す
	@return calc(
		#{$min-size}px + (#{$max-size - $min-size}) *
			((100vw - #{$min-vw}px) / (#{$max-vw - $min-vw}))
	);
}

/**
 * 768px以下（モバイル）専用のレスポンシブサイズ関数
 * 320px以下でも同じ比率で縮小し続ける
 * 
 * @param {Number} $size-380 - 380pxでの基準サイズ
 * @param {Number} $ratio-320 - 320pxでの比率（デフォルト0.84）
 * @param {Number} $ratio-767 - 767pxでの比率（デフォルト1.6）
 * @return {String} - 計算されたcalc()式
 */
@function fsm($size-380, $ratio-320: 0.84, $ratio-767: 1.6) {
	// ビューポート範囲
	$min-vw: 320;
	$max-vw: 767;

	$size-320: $size-380 * $ratio-320;
	$size-767: $size-380 * $ratio-767;

	// 320px以下では同じ比率で縮小（100vw / 320）
	// 320px〜767pxでは通常のcalc計算
	// 767px以上では$size-767で固定
	@return min(
		#{$size-767}px,
		max(
			calc(#{$size-320} * (100vw / 320)),
			calc(
				#{$size-320}px + (#{$size-767 - $size-320}) *
					((100vw - #{$min-vw}px) / (#{$max-vw - $min-vw}))
			)
		)
	);
}

// Flexbox center mixin
@mixin flex-center {
	display: flex;
	align-items: center;
	justify-content: center;
}

// Button reset mixin
@mixin button-reset {
	background: none;
	border: none;
	padding: 0;
	margin: 0;
	cursor: pointer;
	outline: none;
}

// Clearfix mixin
@mixin clearfix {
	&::after {
		content: '';
		display: table;
		clear: both;
	}
}

// PCでのみ表示するミックスイン
@mixin pc-only {
	display: none;

	@include mq(md, min) {
		display: block;
	}
}

// スマホでのみ表示するミックスイン
@mixin sp-only {
	display: block;

	@include mq(md, min) {
		display: none;
	}
}
