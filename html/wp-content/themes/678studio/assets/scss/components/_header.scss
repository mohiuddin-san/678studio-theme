@use '../base/variables' as v;
@use '../base/mixins' as m;

// Header Component - 統合vw()システム適用（Safari 16.4互換）
.header {
	// 自動スケールシステムを有効化
	@include m.auto-scale;
	overflow: visible; // モバイルナビゲーションが表示できるように

	// Safari 16.4 専用フォールバック - CSS Custom Properties が効かない場合
	@supports not (--css: variables) {
		// Static fallback values for very old Safari versions
		width: 100%;
		max-width: 100vw;
		overflow-x: hidden;
	}

	&__container {
		margin: 0 auto;
		// 統合vw()システムでpadding設定
		padding: m.vw(30) m.vw(40) m.vw(10);
		display: flex;
		align-items: center;
		justify-content: space-between;
		position: relative;
		overflow: visible; // モバイルナビゲーションが表示できるように
		background: white; // 背景を明示的に設定
		z-index: 10000; // より高いz-indexに設定

		// CSS変数でヘッダー高さを動的に設定（PC版）
		--header-height: calc(
			#{m.vw(30)} + #{m.vw(10)} + #{m.vw(50)}
		); // padding-top + padding-bottom + logo-height

		// SP用 - 自動判定vw()でレスポンシブ対応
		@include m.mq(md) {
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			width: 100%;
			padding: m.vw(10) m.vw(20) m.vw(10); // パディングを縮小してヘッダー高さを削減
			justify-content: center;
			border-bottom: 1px solid rgba(0, 0, 0, 0.05); // 薄い境界線で区切り
			--header-height: calc(
				#{m.vw(10)} + #{m.vw(10)} + #{m.vw(26)} + 1px
			); // SP版のヘッダー高さ (padding-top + padding-bottom + logo-height) + ボーダー
			background: white !important; // SPでも背景を強制的に白に
			z-index: 10000; // 最前面に
		}
	}

	// デスクトップナビ - スマホで隠す
	&__navigation-desktop {
		display: flex;
		align-items: center;
		justify-content: flex-end;
		gap: m.vw(40); // 統合vw()に変更
		flex: 1;
		overflow: hidden; // 縦横両方のスクロールバーを防ぐ

		@include m.mq(md) {
			display: none;
		}

		// navigationとCTAボタンを横並びに
		.navigation {
			display: flex;
			align-items: center;
			justify-content: flex-end;
			gap: m.vw(40); // 統合vw()に変更
			width: 100%;
		}
	}

	// スマホのハンバーガーボタン
	&__hamburger {
		display: none;

		@include m.mq(md) {
			display: block;
			position: absolute;
			right: m.vw(15); // より右側に移動
			top: 50%;
			transform: translateY(-50%);
			width: m.vw(32); // サイズを小さく（40→32）
			height: m.vw(32); // サイズを小さく（40→32）
			background: none;
			border: none;
			cursor: pointer;
			padding: m.vw(6); // パディングも小さく（8→6）
			z-index: 10002; // ロゴより前面に配置
		}
	}

	// ハンバーガーの線
	&__hamburger-line {
		@include m.mq(md) {
			display: block;
			width: m.vw(20); // 線を短く（24→20）
			height: m.vw(2); // 線の太さはそのまま
			background: #000;
			margin: m.vw(3) 0; // 間隔を狭く（4→3）
			transition: 0.3s;
			position: relative;
		}
	}

	// モバイルメニュー（ヘッダー下展開式）
	&__navigation-mobile {
		display: none;

		&.is-open {
			@include m.mq(md) {
				display: flex;
				position: fixed;
				top: var(--header-height, m.vw(46)); // 動的ヘッダー高さを使用
				left: 0;
				width: 100vw;
				height: calc(100vh - var(--header-height, #{m.vw(46)})); // 動的高さで計算
				/* Safari 16.4+ support for dvh */
				height: calc(100dvh - var(--header-height, #{m.vw(46)}));
				background: white;
				z-index: 9998; // ヘッダーコンテナより下に配置
				padding: 0;
				overflow-y: auto;

				// ナビゲーション全体設定
				.navigation-mobile {
					height: 100%;
					width: 100%;
					overflow-y: auto;
				}
			}
		}
	}
}

// Branding Component
.branding {
	@include m.mq(md) {
		display: flex;
		align-items: center;
		height: 100%;
	}

	&__logo {
		display: block;
		position: relative; // z-indexを確実に適用
		z-index: 10001; // ヘッダーコンテナより前面に

		@include m.mq(md) {
			margin: 0 auto;
			display: flex;
			align-items: center;
		}
	}

	&__image {
		height: auto;
		max-height: m.vw(50); // 統合vw()に変更

		@include m.mq(md) {
			max-height: m.vw(26); // 自動判定vw() - モバイル時のロゴサイズを縮小
		}
	}
}

// ×アニメーション - 2本線での×表示
@include m.mq(md) {
	.header.is-open .header__hamburger-line {
		background: #000 !important;
		display: block !important;
		opacity: 1 !important;
		position: absolute !important;
		top: 50% !important;
		left: 0 !important;
		transform-origin: center center !important;
		margin: 0 !important;
	}

	.header.is-open .header__hamburger-line:first-child {
		transform: translateY(-50%) rotate(45deg) !important;
	}

	.header.is-open .header__hamburger-line:last-child {
		transform: translateY(-50%) rotate(-45deg) !important;
	}
}
