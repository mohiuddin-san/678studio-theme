@use '../../base/mixins' as m;
@use '../../base/variables' as v;

// Studio Hero Slider Section (nii-photo.com style)
// グローバルなSplideページネーション設定
@include m.mq(md) {
    .splide__pagination {
        flex-wrap: nowrap !important;
        white-space: nowrap !important;
        display: flex !important; // 強制的に表示
        opacity: 1 !important;
        visibility: visible !important;

        // 複数のページネーションが生成されることを防ぐ
        &:nth-of-type(n+2) {
            display: none !important;
        }

        // Splideのデフォルトページネーションボタンも表示
        .splide__pagination__page {
            opacity: 1 !important;
            visibility: visible !important;
            background: rgba(255, 153, 0, 0.7) !important; // オレンジ色
            width: 8px !important;
            height: 8px !important;
            border-radius: 50% !important;
            display: inline-block !important;
            margin: 0 4px !important;

            &.is-active {
                background: #ff9900 !important; // アクティブ時は濃いオレンジ
                width: 20px !important;
                border-radius: 4px !important;
            }
        }
    }
}

.studio-hero-slider {
    width: 100%;
    height: 80vh; // 80% viewport height with bottom spacing
    position: relative;
    background: white;
    display: flex;
    align-items: center;
    overflow: hidden; // Prevent spillover

    &__container {
        width: 100%;
        height: 80vh; // Match container height
        position: relative;
    }

    // Splide カスタマイズ (nii-photo.com風)
    .splide {
        height: 80vh; // Match container height

        &__track {
            height: 100%;
            // モバイルでのタッチ操作最適化
            @include m.mq(md) {
                // デフォルトは自動（JSで動的に制御）
                touch-action: auto;
                -webkit-overflow-scrolling: touch; // iOS向けの慣性スクロール

                // Safariでのセンタリング問題を解決（スワイプを阻害しないように）
                padding: 0 !important; // 強制的にpaddingを除去
                margin: 0 !important;

                // スワイプヒントは削除（ページネーションがあるため不要）
            }
        }

        &__list {
            height: 100%;
            display: flex;
            align-items: center;

            @include m.mq(md) {
                // スワイプ機能を維持しながらセンタリング
                padding: 0 !important; // Splideのpaddingを強制的に除去
            }
        }

        &__slide {
            height: 76vh; // Adjusted for 80vh container (slightly less)
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: m.vw(200); // Large border radius like nii-photo.com
            overflow: hidden;

            @include m.mq(md) {
                height: 64vh; // Mobile height adjusted for 80vh container
                border-radius: m.vw-sp(60); // PCの比率に合わせて調整
                // 余白を考慮したサイズ
                width: calc(100% - 60px); // 左右に30pxずつ余白
                margin: 0 auto; // 中央配置
                max-width: 100%; // 親要素の幅を超えないように修正
            }
        }
    }

    &__image {
        width: 100%;
        height: 100%;
        object-fit: cover; // Cover entire slide area
        object-position: center;
        display: block;
    }

    // モバイルでタップ可能な矢印
    .splide__arrows {
        @include m.mq(md) {
            display: flex !important;
        }
        display: none;
    }

    .splide__arrow {
        @include m.mq(md) {
            background: rgba(255, 255, 255, 0.8);
            border: none;
            width: m.vw-sp(40);
            height: m.vw-sp(40);
            opacity: 0.8;
            transition: opacity 0.3s;

            &:hover {
                opacity: 1;
            }

            &--prev {
                left: m.vw-sp(10);
            }

            &--next {
                right: m.vw-sp(10);
            }

            svg {
                fill: #333;
            }
        }
    }

    // カスタムページネーション
    .splide__pagination {
        position: absolute;
        bottom: m.vw(60); // Bottom spacing
        left: 50%;
        transform: translateX(-50%);
        display: flex !important;
        justify-content: center;
        align-items: center;
        gap: m.vw(8);
        z-index: 10;
        max-width: 80%; // 最大幅を制限
        flex-wrap: nowrap; // 改行しない
        overflow: hidden; // はみ出し部分を隠す

        @include m.mq(md) {
            bottom: m.vw-sp(30) !important; // 位置を上げて確実に見えるように
            gap: m.vw-sp(8) !important; // ギャップを広げる
            max-width: 95%;
            flex-wrap: nowrap !important; // 強制的に改行しない
            height: auto !important; // 高さを自動調整
            display: flex !important; // 強制的に表示
            opacity: 1 !important; // 透明度を確実に1に
            visibility: visible !important; // 確実に表示
            pointer-events: auto !important; // クリック可能に

            // 複数のページネーションが表示されるのを防ぐ
            &:not(:first-of-type) {
                display: none !important;
            }
        }

        &__page {
            // ハイブリッドインジケーター：通常はドット、アクティブ時のみライン
            width: m.vw(8);
            height: m.vw(8);
            border-radius: 50%;
            background: rgba(255, 153, 0, 0.4); // オレンジ色（半透明）
            border: none;
            cursor: pointer;
            transition: all 0.4s ease;

            @include m.mq(md) {
                width: m.vw-sp(8) !important; // さらに大きく
                height: m.vw-sp(8) !important;
                min-width: m.vw-sp(8) !important; // 最小サイズを保証
                flex-shrink: 0; // 縮小しない
                background: rgba(255, 153, 0, 0.7) !important; // より濃いオレンジ色で見やすく
                opacity: 1 !important; // 確実に表示
                visibility: visible !important; // 確実に表示
                display: block !important; // ブロック要素として表示
                pointer-events: auto !important; // クリック可能
            }

            &:hover {
                background: rgba(255, 153, 0, 0.7); // オレンジ色（ホバー時）
                transform: scale(1.2);
            }

            &.is-active {
                // アクティブ時はライン型に変化
                width: m.vw(24);
                height: m.vw(3);
                border-radius: m.vw(1.5);
                background: #ff9900; // 濃いオレンジ色（アクティブ時）
                transform: none;
                box-shadow: none; // box-shadowなし

                @include m.mq(md) {
                    width: m.vw-sp(20) !important; // より大きく
                    height: m.vw-sp(4) !important;
                    border-radius: m.vw-sp(2) !important;
                    box-shadow: none !important; // box-shadowなし
                    min-width: m.vw-sp(20) !important;
                    flex-shrink: 0;
                    background: #ff9900 !important; // 濃いオレンジ色を保持
                    opacity: 1 !important; // 確実に表示
                    visibility: visible !important;
                    display: block !important;
                }
            }
        }
    }

    // Image counter for many slides
    &__counter {
        position: absolute;
        bottom: m.vw(30);
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.5);
        color: white;
        padding: m.vw(8) m.vw(16);
        border-radius: m.vw(20);
        font-size: m.vw(14);
        font-weight: 500;
        z-index: 10;
        display: flex;
        align-items: center;
        gap: m.vw(4);

        @include m.mq(md) {
            bottom: m.vw-sp(20);
            padding: m.vw-sp(6) m.vw-sp(12);
            border-radius: m.vw-sp(15);
            font-size: m.vw-sp(12);
            gap: m.vw-sp(3);
        }

        &-current {
            color: #ff9900; // オレンジ色
            font-weight: 700;
        }

        &-separator {
            opacity: 0.7;
        }

        &-total {
            opacity: 0.9;
        }
    }

    // Auto-scale mixin適用
    @include m.auto-scale;
}